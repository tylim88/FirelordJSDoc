---
sidebar_position: 13
---

# What Is New In V2?

This section discuss what problems V2 has solved.

## V1

```ts title='setup.ts'
import { MetaTypeCreator, getFirelord, DocumentReference } from 'firelordjs'

type Parent = MetaTypeCreator<
	{
		a: number
	},
	'columnIDLevel1',
	string
>

type Child = MetaTypeCreator<
	{
		a: 'a' | 'b' | 'c'
		b: { c: number }
	},
	'columnIDLevel2',
	string,
	Parent
>

type GrandChild = MetaTypeCreator<
	{
		e: { f: boolean }[]
	},
	'columnIDLevel3',
	string,
	Child
>

export const parentRef = getFirelord<Parent>()(`columnIDLevel1`) // don't ned to wrap it in a function

export const childRefCreator = (docID1: string) =>
	getFirelord<Child>()(`columnIDLevel1/${docID1}/columnIDLevel2`) // need to wrap it in a function

export const grandchildRefCreator = (docID1: string, docID2: string) =>
	getFirelord<GrandChild>()(
		`columnIDLevel1/${docID1}/columnIDLevel2/${docID2}/columnIDLevel3` // need to wrap it in a function
	)
```

```ts title='implementation.ts'
import { parentRef, childRefCreator, grandchildRefCreator } from './setup.ts'

const parentDocRef = parentRef.doc('docIDLevel1')
const childDocRef = childRefCreator('docIDLevel1').doc('docIDLevel2')
const grandChildDocRef = grandchildRefCreator('docIDLevel1', 'docIDLevel2').doc(
	'docIDLevel3'
)

const parentColRef = parentRef.collection()
const childColRef = childRefCreator('docIDLevel1').collection()
const grandChildColRef = grandchildRefCreator(
	'docIDLevel1',
	'docIDLevel2'
).collection()

const parentColGroupRef = parentRef.collectionGroup()
const childColGroupRef = childRefCreator(
	'docIDLevel1' // any string is fine, collectionGroup does not care about document ID
).collectionGroup()
const grandChildColGroupRef = grandchildRefCreator(
	'docIDLevel1', // any string is fine, collectionGroup does not care about document ID
	'docIDLevel2' // any string is fine, collectionGroup does not care about document ID
).collectionGroup()
```

V1 is pleasant to work with top collection but not with child collection.

In order to resue `FirelordRef`, we need to wrap it in another function because in most cases document IDs are dynamic.

But still it is awkward neither `docRef`,`colRef` nor `colGroupRef` feel intuitive to create, especially `colGroupRef`.

Despite `colGroupRef` not needing any document ID, we still need to supply two documentIDs to it.

The way of exporting top level ref and child ref is different, this is harmful to code structure.

Finally we need to call `getFirelord` twice to create `FirelordRef` because `getFirelord` is a curry function.

Curry function is useful if we have more than one Firestore instance, but most applications need only one instance, so curry provide no real value other than increasing cognitive cost.

## Version 2

```ts title='setup.ts'
import { MetaTypeCreator, getFirelord, getFirestore } from 'firelordjs'

const db = getFirestore()

type Parent = MetaTypeCreator<
	{
		a: number
	},
	'columnIDLevel1',
	string
>

type Child = MetaTypeCreator<
	{
		a: 'a' | 'b' | 'c'
		b: { c: number }
	},
	'columnIDLevel2',
	string,
	Parent
>

type GrandChild = MetaTypeCreator<
	{
		e: { f: boolean }[]
	},
	'columnIDLevel3',
	string,
	Child
>

export const parentRef = getFirelord<Parent>(db, 'columnIDLevel1')

export const childRef = getFirelord<Child>(
	db,
	'columnIDLevel1',
	'columnIDLevel2'
)

export const grandChildRef = getFirelord<GrandChild>(
	db,
	'columnIDLevel1',
	'columnIDLevel2',
	'columnIDLevel3'
)
```

```ts title='implementation.ts'
import { parentRef, childRef, grandChildRef } from './setup.ts'

const parentDocRef = parentRef.doc('docIDLevel1')
const childDocRef = childRef.doc('docIDLevel1', 'docIDLevel2')
const grandChildDocRef = grandChildRef.doc(
	'docIDLevel1',
	'docIDLevel2',
	'docIDLevel3'
)

const parentColRef = parentRef.collection()
const childColRef = childRef.collection('docIDLevel1')
const grandChildColRef = grandChildRef.collection('docIDLevel1', 'docIDLevel2')

const parentColGroupRef = parentRef.collectionGroup()
const childColGroupRef = childRef.collectionGroup()
const grandChildColGroupRef = grandChildRef.collectionGroup()
```

In version 2:

1. top level and child collection are exported in a similar fashion.
2. `collectionGroup` need 0 argument regardless of level.
3. getFirelord is no longer a curry function and `db` paramter is now mandatory(this is to reduce confusion caused by funtion overloading).

More about [Child Meta Type](./guides/child_metatype).

## Should I Update to V2?

You can stay with V1 but we strongly recommend you use V2 in your future projects.
